<!DOCTYPE html>
<html>

<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" type="text/css" href="../../Public/css/SpecifiedBook.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb"
        crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.5.2/animate.min.css" integrity="sha384-OHBBOqpYHNsIqQy8hL1U+8OXf9hH6QRxi0+EODezv82DfnZoV7qoHAZDwMwEJvSw"
        crossorigin="anonymous">
    <!-- or -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css" integrity="sha384-OHBBOqpYHNsIqQy8hL1U+8OXf9hH6QRxi0+EODezv82DfnZoV7qoHAZDwMwEJvSw"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.9/semantic.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.9/semantic.min.js"></script>
    <script src="../../Public/js/SpecifiedBook.js"></script>
</head>

<body>
    <!-- Header -->
    <div class="container-fluid all" style="padding:0px">
        <nav class="navbar navbar-expand-lg navbar navbar-dark bg-dark fixed-top">
            <a class="navbar-brand mr-auto " style="color:yellow" href="./Homepage.html">
                <h3>NOW READ</h3>
            </a>
            <div id="session">
                <div class="nav-item ">
                    <a class="nav-link headerSelect" href="../Login/login.php">Login</a>
                </div>
                <div class="nav-item ">
                    <a class="nav-link headerSelect" href="../Login/register.php">Register</a>
                </div>
            </div>
        </nav>
        <nav class="navbar navbar-expand-lg navbar navbar-dark bg-dark content">
            <a class="navbar-brand" href="./Homepage.html">
                <img src="http://hkndcdn.now-do.com/static/images/phnx/index/01_SearchBar_boy.png" alt="">
            </a>
            <div class="titlePage ">
                <h3>Read</h3>
            </div>
            <div class="input-group search mx-auto">
                <input type="text" class="form-control search" placeholder="Search for..." aria-label="Search for...">
                <span class="input-group-btn">
                    <button class="btn btn-secondary" type="button">Go!</button>
                </span>
            </div>

        </nav>
        <div class="container-fluid">
            <div class=" height350 coverImg">
                <div class="container">
                    <div class="row">
                        <div class="col-12 col-md-12 col-lg-12 padding150" id="book-info-box">

                        </div>

                    </div>
                </div>

            </div>
            <div class="container  " style="background-color:white">
                <div class="row">
                    <div class="col-12 col-md-6 col-lg-4" style="height:50px;margin-bottom:30px">

                    </div>
                    <div class="col-12 col-md-6 col-lg-8 displayInlineBlock" style="margin-top:40px; padding:20px" id="info-box">
                        
                    </div>
                    <div class="row width100 " style="width: 100%;padding-left:5%">
                        <div class="col-12">
                            <div class="ui secondary pointing menu ">
                                <a class="item active ">
                                    Content
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="row padding5" style="width:100%">
                        <div class="col-12 col-md-12 col-lg-12" id="pdf-box">
                            
                        </div>

                    </div>
                    <div class="row width100 " style="width: 100%;padding-left:5%">
                        <div class="col-12">
                            <div class="ui secondary pointing menu ">
                                <a class="item active ">
                                    Comments
                                </a>
                            </div>
                        </div>

                        <div id="comment-box">

                        </div>

                    </div>



                </div>


            </div>

        </div>
        <footer>
            <ul>
                <li>
                    <a href="#">Facebook</a>
                    |


                </li>
                <li>
                    <a href="#">Instagram</a>
                    |
                </li>
                <li>
                    <a href="#">Github</a>
                </li>
            </ul>
            <p> The product of team. Thanks for all your support</p>
        </footer>
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh"
            crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ"
            crossorigin="anonymous"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script>
            var url = new URL(window.location.href);
            var bookid = url.searchParams.get("bookid");

            $(document).ready(function () {
                $.ajax({
                    url: "../Controllers/GetSessionHandler.php",
                    type: "post",
                    success: function (data) {
                        console.log(JSON.parse(data))
                        $("#session").empty();
                        $("#session").append('<div class="nav-item">'
                                + '<a class="nav-link headerSelect" href="../Login/login.php">Welcome back, <b style="color: blue;">' + JSON.parse(data)["username"] + '</b></a>'+
                                '<a class="nav-link headerSelect" href="../Login/logout.php">Log out</a></div>');
                    }
                })

                $.ajax({
                    url: "../Controllers/ReadPageHandler.php",
                    type: "post",
                    data: {bookid: bookid},
                    success: function (data) {
                        console.log(JSON.parse(data));
                        addBookInfo(JSON.parse(data));
                    }
                })
            });

            function addBookInfo(data) {
            var res = '';

            res += 
                `<div>
                    <img class="ui medium rounded image imageSpecifiedBook" src="${data[0][7]}">
                </div>
                <div class="overallDescrip">
                    <h1 class="fontStyle">Name: ${data[0][1]}</h1>
                    <h2 class="fontStyle">Author: ${data[0][2]}</h2>
                    <h2 class="fontStyle">Category: ${data[0][3]}</h2>
                    <h2 class="fontStyle">View: ${data[0][4]}</h2>
                </div>`;

            $('#book-info-box').html('');
            $('#book-info-box').append(res);

            $('#description-box').html(`${data[0][5] ? data[0][5] : 'you will love it'}`);

            $('#info-box').html('');
            $('#info-box').append(`
                <div class="buttonInTitle">
                    <a href="./SpecifiedBook.html?bookid=${data[0][0]}"><button class="positive ui button ">Info</button></a>
                </div>
            `);

            $('#pdf-box').html('');
            $('#pdf-box').append(`
            <iframe src="${data[0][6]}" height="1000px" width="100%" allowfullscreen></iframe>
            `);

            $.ajax({
                url: "../Controllers/SpecifiedBookHandler.php",
                type: "post",
                data: {action: 'getComments', bookid: bookid},
                success: function (data) {
                    console.log(JSON.parse(data));

                    dt = JSON.parse(data);

                    var comments = '';

                    for (i = 0; i < dt.length; i++) {
                        comments += 
                        `<div class="col-md-12">
                            <div class="media">
                                <img class="align-self-start mr-3" src="./giphy.gif"
                                    alt="Generic placeholder image">
                                <div class="media-body">
                                    <h5 class="mt-0">${dt[i][1]}</h5>
                                    <p>${dt[i][3]}</p>
                                </div>
                            </div>
                        </div>`;
                    }

                    $('#comment-box').html('');
                    $('#comment-box').append(comments);
                }
            })
        }
        </script>

</body>

</html>